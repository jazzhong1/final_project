<!DOCTYPE html>
<html>
<title>W3.CSS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="css/review.css">

<body>
  <div class="container">

    <div class="col-xs-8">
      <!--중복되서-->
      <style>
    
      </style>




      <div class="page-header">
        <p style="font-size: 14pt; font-weight: bold;">&nbsp;&nbsp;&nbsp;리뷰</p>
      </div>


      <ul id='comment-main' class='level1'>
        <li id='review-view' class='comment-reply level1'>
          <!--댓글보기-->
          <div class='row'>
            <div class="col-xs-8">
              <div class="row">
                <div class="col-md-6 ">
                  <span class='panel-2-body-font'>아이디:</span>
                  <!--아이디부여-->
                </div>
                <div class="col-md-6 date-padding">
                  <span class='panel-2-body-font'>작성일:</span><br>
                  <!--date 부여 -->
                </div>
              </div>
              <span class="rating"> <label> <span class="icon">평점: </span>

              </label>
              </span>

            </div>
            <div class='col-xs-4 col-md-3-body-center'>
            </div>
            <div class="col-xs-12">
              <a id="menu-modal" data-toggle="modal" data-target=".pop-up-3">
               <img class='comment-check-img' src="images/truckReview/<%=reviewList.get(i).getReviewCommentRimage()%>" alt="Card image cap"onclick="fn_modal_review('images/truckReview/<%=reviewList.get(i).getReviewCommentRimage()%>');"></a><br>
            </div>
          </div>

          <div class="row" style="text-align:right;">
            <div class="col-xs-8"></div>
            <div class="col-xs-4 result-btn-positon">
              <br>

              <button class='btn btn-light basic-btn btn-update' type="button" onclick="fn_commentDelete(<%=k%>,<%=reviewList.get(k).getReviewCommentPk()%>)">수정</button>
              <button id="delete-button" class='btn btn-light basic-btn btn-delete' type="button" onclick="fn_commentDelete(<%=i%>,<%=reviewList.get(i).getReviewCommentPk()%>)">삭제</button>
            </div>
          </div>
          <hr>
        </li>
        <ul id='comment-reply' class="level2">
          <li class='review-comment-view<%=k%>' textalign="right">
            <div class='row'>
              <div class="col-xs-2"></div>
              <div class="col-xs-10" id="review-list">
                <div class="row">
                  <div class="col-xs-6 ">
                    <span class='panel-2-body-font'>아이디:</span>
                    <!--아이디부여-->
                  </div>
                  <div class="col-md-6 date-padding">
                    <span class='panel-2-body-font'>작성일:</span><br>
                    <!--date 부여 -->
                  </div>
                </div>
                <div class="row">
                  <div class="col-xs-12">
                    <span></span>
                  </div>
                  <br>
                </div>
                <div class="row">
                  <div class="col-xs-12" align="right">

                    <button class='btn btn-light basic-btn btn-update' type="button" onclick="fn_commentDelete(<%=k%>,<%=reviewList.get(k).getReviewCommentPk()%>)">수정</button>

                    <button class='btn btn-light basic-btn btn-delete' type="button" onclick="fn_commentDelete(<%=k%>,<%=reviewList.get(k).getReviewCommentPk()%>)">삭제</button>

                    <hr>
                  </div>
                </div>
              </div>
            </div>
          </li>

        </ul>
      </ul>


      <div class="col-xs-12" style="text-align:center;">
        <button id="load-review-button" class='btn btn-light basic-btn' type="button">더보기</button>
      </div>
      <br> <br> <br>

      <!--모달 틀-->
      <div class="modal fade pop-up-3" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel-1" aria-hidden="true" data-backdrop="false">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class=" close" data-dismiss="modal" aria-hidden="true">×</button>
              <h4 class="modal-title" id="myLargeModalLabel-1">확대 이미지</h4>
            </div>
            <div class="modal-body">
              <img id="modal-review-img" class="img-responsive img-rounded center-block" alt="" width="500" height="500">
            </div>
          </div>
        </div>
      </div>







      <ul id="comment-insert">
        <li>
          <form name="TruckCommentFrm" action="" method="post" enctype="multipart/form-data">
            <!--form클래스 아이디부여-->
            <div class='row'>
              <div class="col-xs-12">
                <div class="row">
                  <div class="col-md-6 ">
                    <input type="hidden" name="truckPk" value="<%=truckPk%>" /> <input type="hidden" name="reviewCommentWriter" value="<%=memberId%>" />
                    <input type="hidden" name="reviewCommentRef" value="0" /> <input type="hidden" name="reviewCommentLevel" value="1" /> <input type="hidden" name="memberPk" value="1" /> <span class='panel-2-body-font' name="reviewCommentWriter"><%=memberId%></span>

                    <!--아이디부여-->
                  </div>
                  <div class="col-md-6 date-padding panel-2-body-font">
                    작성일 <span id="localTime" class='panel-2-body-font'></span><br>
                    <!--date 부여 -->
                  </div>
                </div>

                <span class="rating"> <label> <input type="radio"
  							name="reviewStar" value="1" /> <span class="icon">★</span>
                </label> <label> <input type="radio" name="reviewStar" value="2" />
  							<span class="icon">★</span> <span class="icon">★</span>
  					</label> <label> <input type="radio" name="reviewStar" value="3" />
  							<span class="icon">★</span> <span class="icon">★</span> <span
  							class="icon">★</span>
  					</label> <label> <input type="radio" name="reviewStar" value="4" />
  							<span class="icon">★</span> <span class="icon">★</span> <span
  							class="icon">★</span> <span class="icon">★</span>
  					</label> <label> <input type="radio" name="reviewStar" value="5" />
  							<span class="icon">★</span> <span class="icon">★</span> <span
  							class="icon">★</span> <span class="icon">★</span> <span
  							class="icon">★</span>
  					</label>
                </span> <br>
                <div class="row">
                  <div class="col-xs-12">
                    <!-- image-preview-filename input [CUT FROM HERE]-->
                    <div class="input-group image-preview">
                      <input type="text" class="form-control image-preview-filename" disabled="disabled">
                      <!-- don't give a name === doesn't send on POST/GET -->
                      <span class="input-group-btn">
                                  <!-- image-preview-clear button -->
                                  <button type="button" class="btn btn-default image-preview-clear" style="display:none;">
                                      <span class="glyphicon glyphicon-remove"></span> Clear
                      </button>
                      <!-- image-preview-input -->
                      <div class="btn btn-default image-preview-input">
                        <span class="glyphicon glyphicon-folder-open"></span>
                        <span class="image-preview-input-title">Browse</span>
                        <input type="file" accept="image/png, image/jpeg, image/gif" name="input-file-preview" />
                        <!-- rename it -->
                      </div>
                      </span>
                    </div>
                    <!-- /input-group image-preview [TO HERE]-->
                  </div>
                </div>
                <div class="row">
                  <div class="col-xs-12">
                    <textarea class="form-control" id="content" name="reviewCommentContent" placeholder="내용을 입력하세요." rows="2" cols="100" style="resize: none;" autofocus required="required"></textarea>
                  </div>
                  <div class="col-xs-12" style="text-align:center;">
                    <br>
                    <button id="result-button" class='btn btn-light basic-btn btn-center' type="submit">완료</button>

                    <button id="reset-button" class='btn btn-light basic-btn btn-center' type="reset">취소</button>
                    <hr>
                </div>
              </div>
            </div>

          </form>
        </li>
      </ul>

    </div>
  </div>


  <script>
    //댓글삭제 ajax
    function fn_commentDelete(index, pk) {
      $.ajax({
        url: "<%=request.getContextPath()%>/truckReviewCommentDelete",
        type: "POST",
        data: {
          reviewCommentPk: pk
        },
        success: function(data) {
          alert(data.msg);
          var delbtn = $('#delete-button');
          delbtn.parent().parent().parent().parent("ul").remove();
          /* parent 4번
          var comment=$("#review-view"+index);
          comment.remove(); */
        },
        error: function(request, status, error) {
          alert("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
        }
      })
    }

    $("#myonoffswitch").on('click', function(e) {
      e.preventDefault();
    });

    //별 스크립트
    $(':radio').change(function() {
      console.log('New star rating: ' + this.value);
    });


    //미리보기 스크립트
    $(document).on('click', '#close-preview', function() {
      $('.image-preview').popover('hide');
      // Hover befor close the preview
      $('.image-preview').hover(
        function() {
          $('.image-preview').popover('show');
        },
        function() {
          $('.image-preview').popover('hide');
        }
      );
    });

    $(function() {
      // Create the close button
      var closebtn = $('<button/>', {
        type: "button",
        text: 'x',
        id: 'close-preview',
        style: 'font-size: initial;',
      });
      closebtn.attr("class", "close pull-right");
      // Set the popover default content
      $('.image-preview').popover({
        trigger: 'manual',
        html: true,
        title: "<strong>Preview</strong>" + $(closebtn)[0].outerHTML,
        content: "There's no image",
        placement: 'bottom'
      });
      // Clear event
      $('.image-preview-clear').click(function() {
        $('.image-preview').attr("data-content", "").popover('hide');
        $('.image-preview-filename').val("");
        $('.image-preview-clear').hide();
        $('.image-preview-input input:file').val("");
        $(".image-preview-input-title").text("Browse");
      });
      // Create the preview image
      $(".image-preview-input input:file").change(function() {
        var img = $('<img/>', {
          id: 'dynamic',
          width: 250,
          height: 200
        });
        var file = this.files[0];
        var reader = new FileReader();
        // Set preview image into the popover data-content
        reader.onload = function(e) {
          $(".image-preview-input-title").text("Change");
          $(".image-preview-clear").show();
          $(".image-preview-filename").val(file.name);
          img.attr('src', e.target.result);
          $(".image-preview").attr("data-content", $(img)[0].outerHTML).popover("show");
        }
        reader.readAsDataURL(file);
      });
    });

    //현재시간 스크립트
    $(function() {
      function fn_localTime() {
        var now = new Date();
        var year = now.getFullYear();
        var mon = (now.getMonth() + 1) > 9 ? '' + (now.getMonth() + 1) : '0' + (now.getMonth() + 1);
        var day = now.getDate() > 9 ? '' + now.getDate() : '0' + now.getDate();

        var st_date = year + '-' + mon + '-' + day;


        return st_date;
      }
      $("#localTime").html(fn_localTime());



    })

    //모달주석
    function fn_modal_review(rimage) {
      console.log(rimage);
      $("#modal-review-img").attr("src", rimage);
    }

    //더보기
    $(function() {
      $(".more-comment").slice(0, 10).show(); // 최초 10개 선택
      $("#load-review-button").click(function(e) { // Load More를 위한 클릭 이벤트e
        e.preventDefault();
        $(".more-comment:hidden").slice(0, 10).show(); // 숨김 설정된 다음 10개를 선택하여 표시
        if ($(".more-comment:hidden").length == 0) { // 숨겨진 DIV가 있는지 체크
          $("#load-review-button").hide();
        }
      });
    });
  </script>

</body>

</html>
