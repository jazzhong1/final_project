<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8' />
  <link href='css/fullcalendar.min.css' rel='stylesheet' />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link href='css/scheduler.min.css' rel='stylesheet' />


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src='js/moment.min.js'></script>
  <script src='js/fullcalendar.min.js'></script>
  <script src='locale/ko.js'></script>
  <script src='js/gcal.min.js'></script>
  <script src='js/scheduler.min.js'></script>


  <link href="js/index.js">
  <link href="css/index1.css" rel="stylesheet">
  <link href="css/index2.css" rel="stylesheet">

  <!--  <script src='../lib/jquery-ui.min.js'></script>-->

  <!--  <script src='../lib/jquery.timepicker.min.js'></script>-->
  <!--<link href='../lib/jquery.timepicker.min.css' rel='stylesheet' />-->

  <!--<link href='../lib/fullcalendar.print.min.css' rel='stylesheet' media='print' />-->
  <!--부트스트램 them-->
  <!--<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">-->


  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: "Lucida Grande", Helvetica, Arial, Verdana, sans-serif;
      font-size: 14px;
    }

    #calendar {
      max-width: 600px;
      margin: 50px auto;
    }

    /*custom*/

    .fc-highlight,
    .alert-info {
      background: rgb(255, 252, 253);
    }

    .fc-day-number {
      color: black;
    }

    /*.ui-timepicker-container {
      z-index: 1080 !important;
    }*/

    #reservaiton-form tr td {
      border-top: 0px !important;
    }

    #reservaiton-form label {
      padding-top: 5px;
    }

    #reserDate,
    #reserName {
      text-align: left;
      padding-top: 3px;
      padding-left: 3px;
      font-size: 12pt;
    }

    .fc-day-grid-container {
      pointer-events: none;
      cursor: default;
    }

    .fc-more {
      pointer-events: visible;
    }

    .fc-day-header.fc-sun span {
      color: red;

    }

    .fc-sun .fc-day-number {
      color: red;
    }

    .fc-license-message{
      display: none!important;
    }
  </style>




  <script>
    $(function() { // document ready
      //$('fc-month-view').click(function(e) { e.preventDefault(); });

      var min = '10:00:00';
      var max = '23:00:00';
      var reserDate;
      var startTime;
      var endTime;
      var checkDate;
  /*변수 초기화*/
      var reservaiton = [{
          id: '1',
          resourceId: 'a',
          start: '2018-04-06',
          end: '2018-04-08',
          title: 'event 1'
        },
        {
          id: '2',
          resourceId: 'a',
          start: '2018-04-07T09:00:00',
          end: '2018-04-07T14:00:00',
          title: 'event 2'
        },
        {
          id: '3',
          resourceId: 'b',
          start: '2018-04-07T12:00:00',
          end: '2018-04-08T06:00:00',
          title: 'event 3'
        },
        {
          id: '4',
          resourceId: 'c',
          start: '2018-04-07T07:30:00',
          end: '2018-04-07T09:30:00',
          title: 'event 4'
        },
        {
          id: '5',
          resourceId: 'd',
          start: '2018-04-07T10:00:00',
          end: '2018-04-07T15:00:00',
          title: 'event 5'
        },
        {
          id: '6',
          resourceId: 'a',
          start: '2018-07-24T10:00:00',
          end: '2018-07-24T10:30:00',
          color: 'rgb(49, 128, 208)',
          title: '홍성진님 예약'
        }, {
          id: '7',
          resourceId: 'b',
          start: '2018-07-24T10:30:00',
          end: '2018-07-24T11:00:00',
          title: '홍성진님 예약'
        },
        {
          id: '8',
          resourceId: 'c',
          start: '2018-07-24T11:30:00',
          end: '2018-07-24T12:00:00',
          title: '홍성진님 예약'
        },
        {
          id: '9',
          resourceId: 'c',
          start: '2018-07-24T12:30:00',
          end: '2018-07-24T13:00:00',
          title: '홍성진님 예약',
          description: 'This is a cool event'

        }
      ];

      var employee = [{
          id: 'a',
          title: '원장님'
        },
        {
          id: 'b',
          title: '디자이너',
          eventColor: 'green'
        },
        {
          id: 'c',
          title: '디자이너',
          eventColor: 'orange'
        },
      ];



      $('#calendar').fullCalendar({
        themeSystem: 'bootstrap3',


        editable: true, //드래그해서 움직이는것
        eventLimit: true, // allow "more" link when too many events
        lang: "ko",

        header: {
          left: 'prev,next',
          center: 'title',
          right: 'month,agendaThreeDay,agendaDay' //agendaTwoDay
        },

        views: {
          agendaThreeDay: {
            duration: {
              days: 3
            },

            type: 'agenda',

            // views that are more than a day will NOT do this behavior by default
            // so, we need to explicitly enable it
            groupByResource: true

            //// uncomment this line to group by day FIRST with resources underneath
            //groupByDateAndResource: true
          }
        },

        //// uncomment this line to hide the all-day slot
        allDaySlot: false,

        //설정
        minTime: min,
        maxTime: max,

        resources: employee,

        events: reservaiton,

        displayEventTime: true,


        googleCalendarApiKey: "AIzaSyDcnW6WejpTOCffshGDDb4neIrXVUA1EAE", // Google API KEY
        eventSources: [
          // 대한민국의 공휴일
          {
            googleCalendarId: "ko.south_korea#holiday@group.v.calendar.google.com",
            className: "koHolidays",
            color: "#be0000",
            textColor: "#FFFFFF"
          }
        ],





      /*  select: function(start, end, jsEvent, view, resource) {
          console.log(
            'select',
            startTime = start.format(),
            endTime = end.format(),
            resource ? resource.id : '(no resource)',
          $(".fc-highlight").css("background", " rgb(255, 227, 235)");
        },
          );*/


        dayClick: function(date, jsEvent, view, resource) {
          console.log(
            'dayClick',
            reserDate = date.format(),
            resource ? resource.id : '(no resource)'
          );
          console.log('Clicked on: ' + date.format());
          console.log('reserDate ' + reserDate);
          console.log('Coordinates: ' + jsEvent.pageX + ',' + jsEvent.pageY);
          console.log('Current view: ' + view.name);
          $('#reserDate').html(date.format('YYYY년MM월DD일 HH시mm분'));
          $('#calendarModal').modal();

          //var title =$('select[name=choice1]').val()
          var title = $('#reservation-userName').val();
          title += "-" + $('select[name=choice-employee]').val() + "님"
          var id = $('#reservation-id').val();
          var choice1 = $('#choice1').val();
          var choice2 = $('#choice2').val();
          var choice_employee = $('#choice-employee').val();

          /*    var eventData;
              if (title) {
                eventData = {
                  title: title,
                  start: date
                };
                $('#calendar').fullCalendar('renderEvent', eventData, true); // stick? = true
              }
              $('#calendar').fullCalendar('unselect');*/

          $("#result-reservaiton").one('click', function() {
            /*reservation 객체 추가로직*/
            var aJson = new Object();
            aJson.id = '8';
            aJson.resourceId = 'a';
            aJson.start = '2018-07-24T13:15:00';
            aJson.end = '2018-07-24T15:15:00';
            aJson.color = 'rgb(49, 128, 208)';
            aJson.title = '홍성진님 예약'
            reservaiton.push(aJson);

            /*30분 추가*/
            console.log(reservaiton);
            var javaScriptRelease = Date.parse(date);
            alert(javaScriptRelease + 1800000);
            javaScriptRelease += 1800000;


            $('#calendar').fullCalendar('renderEvent', {
              title: title,
              start: date, //specify start date
              id: '10',
              resourceId: resource.id,
              end: javaScriptRelease
              //choice1: choice1,
              //choice2: choice2,
              //choice_employee: choice_employee
            });

          });

        },


        eventClick: function(calEvent, jsEvent, view) {
          $('#reserDate').html(calEvent.start.format('YYYY년MM월DD일 HH시mm분'));
          var check = calEvent.choice1;
          console.log(typeof calEvent.choice_employee);
          //$("#choice1").val("Someoranges").attr("selected", "selected");


          //$('#choice1').val(calEvent.choice1).prop("selected", true);;
          //$('#choice2').option(calEvent.choice2).attr("selected", "selected");
          //$('#choice_employee').val(calEvent.choice_employee).attr("selected", "selected");

          $('#calendarModal').modal();

          /*alert('Event: ' + calEvent.start.format());
          alert('Coordinates: ' + jsEvent.pageX + ',' + jsEvent.pageY);
          alert('View: ' + view.name);*/
          $('#remove-reservaiton').one('click', function() {
            //var check = prompt("예약비밀번호입력");
            var check1 = confirm("삭제하시겠습니까?")
            if (check1 ==true) {
              $('#calendar').fullCalendar('removeEvents', calEvent.id);
              $('#calendarModal').modal('toggle');
            }
          })
        },
      });


      /*하루 날린timepicker...
      $('input.timepicker').timepicker({
        defaultTime: '09:00 AM',
        timeFormat: 'HH시mm분',
        // year, month, day and seconds are not important
        minTime: min,
        maxTime: max,
        // time entries start being generated at 6AM but the plugin
        // shows only those within the [minTime, maxTime] interval
        startHour: 6,
        // the value of the first item in the dropdown, when the input
        // field is empty. This overrides the startHour and startMinute
        // options
        //  startTime: new Date(0, 0, 0, 8, 20, 0),
        // items in the dropdown are separated by at interval minutes
        interval: 60, //몇분단위
        autoclose: true

      });*/
    });
  </script>
  <style>
  </style>
</head>

<body>

  <div id='calendar'></div>
  <div id='calendarModal' class="modal fade pop-up-1" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel-1" aria-hidden="true">
    <div class="modal-dialog" style="width:400px;">
      <form class="" action="" method="post">

        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h4 class="modal-title" id="myLargeModalLabel-1">예약등록</h4>
          </div>
          <div class="modal-body">

            <div class="row">
              <div class="form-group">
                <table id="reservaiton-form" class="table">
                  <thead>
                    <tr>
                      <td><label for="sel1">예약자:</label></td>
                      <td colspan="6">
                        <p id="reserName" for="sel1">홍성진</p>
                        <!---->
                      </td>
                    </tr>
                  </thead>
                  <tbody>

                    <tr>
                      <td><label for="sel1">예약일시:</label></td>
                      <td colspan="6">
                        <p id="reserDate" for="sel1"></p>
                        <!--<input type="type" id="reservation-timepicker" class="timepicker form-control input-sm" name="reservation-timepicker" style="width:130px;" />-->
                        <input type="hidden" id="reservation-userName" name="reservation-userName" value="홍성진 예약입니다." />
                        <input type="hidden" id="reservation-id" name="reservation-id" value="10" />
                      </td>
                    </tr>

                    <tr>
                      <td><label for="sel1">시술선택:</label></td>
                      <td style="width:72">
                        <select class="form-control input-sm" id="choice1" name='choice1'> <!--점주레벨이 아니면 disabled-->
                        <option>손</option>
                        <option>발</option>
                        </select>
                      </td>
                      <td colspan="5" style="width: 172px;">
                        <select class="form-control input-sm" id="choice2" name='choice2'>  <!--점주레벨이 아니면 disabled-->
                          <option>메뉴1</option>
                          <option>메뉴2</option>
                          <option>메뉴3</option>
                          </select>
                      </td>
                    </tr>

                    <tr>
                      <td><label for="sel1">담당자:</label></td>
                      <td>
                        <select class="form-control input-sm" id="choice-employee" name="choice-employee">  <!--점주레벨이 아니면 disabled-->
                        <option value="a">원장</option>
                        <option value="b">디자이너1</option>
                        <option value="c">디자이너2</option>
                        </select></td>
                    </tr>
                </table>
                </tbody>
                <hr>
                <div class="col-xs-2"></div>
                <div class="col-xs-4" style="text-align:right;"><button id="result-reservaiton" type="button" class="btn btn-success" name="button">확인</button></div>
                <!--점주만 삭제-->
                <div class="col-xs-4" style="text-align:left;"><button id="remove-reservaiton" type="button" class="btn btn-danger" name="button">삭제</button></div>
                <div class="col-xs-2"></div>

              </div>

            </div>
          </div>
          <!-- /.modal-content -->
      </form>
      </div>
      <!-- /.modal-dialog -->
    </div>
    <!-- /.modal mixer image -->
  </div>


</body>

</html>
